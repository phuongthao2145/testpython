{% extends "demo/base.html" %}
{% block title %}index{% endblock %}

{% block content %}
{% if p != ''%}
<h4>Thông tin quận/huyện {{users.0.district}} (đã trừ các trường hợp hết cách ly)</h4>
<div style="overflow-x:auto;">
    <table class="table table-striped table-hover table-responsive">
        <thead>
        <tr>
            <th>Số Ca F0</th>
            <th>Số Ca F1</th>
            <th>Số Ca F2</th>
            <th>Tong số lượng cách ly tại quận/huyện {{users.0.district}}</th>
            <th>Số lượng ca nhiễm mới ngày {% now "d/m/Y" %}</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td id="f0"></td>
            <td id="f1"></td>
            <td id="f2"></td>
            <td id="SL"></td>
            <td id="fnew"></td>
        </tr>
    </table>
    <h4>Thông tin chi tiết về các ca mắc tại quận/huyện {{p.title}}</h4>
</div>

<div style="overflow-x:auto; overflow-y:auto; height:500px">
    <table class="table table-striped table-hover js-sort-table table-responsive">
        <tbody>
        <tr>
            <td class="pe-0">
                <table class="table table-striped table-hover js-sort-table table-responsive">
                    <thead class="sticky-top bg-light">
                    <tr>
                        <th scope="col">Tên Phường/Xã</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for row in users %}
                    <tr>
                        <td class="field-patientcode">
                            {% if row %}
                            <a href="{% url 'demo:view' row.slug %}">{{ row }}</a>
                            {% else %}
                            -
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </td>
            <td class="ps-0">
                <table class="table table-striped table-hover js-sort-table table-responsive" id="res">
                    <thead class="sticky-top bg-light">
                    <tr>
                        <th scope="col">Số ca F0</th>
                        <th scope="col">Số ca F1</th>
                        <th scope="col">Số ca F2</th>
                        <th>Số lượng cách ly tại Phường/Xã</th>
                        <th>Số lượng ca nhiễm mới ngày {% now "d/m/Y" %}</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for p1 in p %}
                    <tr>
                        <td class="countable">{{p1.f0|length }}</td>
                        <td class="countable">{{p1.f1|length}}</td>
                        <td class="countable">{{p1.f2|length}}</td>
                        <td class="countable">{{p1.isolate|length}}</td>
                        <td class="countable">{{p1.newf0}}</td>
                    </tr>

                    {% endfor %}
                    </tbody>
                </table>
            </td>
        </tr>
        </tbody>
    </table>

</div>
{% endif%}
{% endblock %}

{% block chart %}
{% if p != '' %}
<div class="breadcrumbs">
    <i class="fas fa-chart-pie" id="pie"></i>
    <i class="fas fa-chart-bar" id="bar"></i>
</div>
<div id="chart">
</div>
<script type="text/javascript">
const f0 = document.querySelector("#f0")
const f1 = document.querySelector("#f1")
const f2 = document.querySelector("#f2")
const SL = document.querySelector("#SL")
const fnew = document.querySelector("#fnew")
//sum
 let table = document.getElementById("res"), sumf0 = 0, sumf1 = 0, sumf2 = 0,sumSL = 0,sumnew = 0;

            for(let i = 1; i < table.rows.length; i++)
            {
                sumf0 += parseInt(table.rows[i].cells[0].innerHTML);
                sumf1 += parseInt(table.rows[i].cells[1].innerHTML);
                sumf2 += parseInt(table.rows[i].cells[2].innerHTML);
                sumSL += parseInt(table.rows[i].cells[3].innerHTML);
                sumnew += parseInt(table.rows[i].cells[4].innerHTML);
            }
            f0.innerHTML = sumf0
            f1.innerHTML = sumf1
            f2.innerHTML = sumf2
            SL.innerHTML = sumSL
            fnew.innerHTML = sumnew
//Load google charts
 google.charts.load('current', {'packages':['corechart', 'bar']});
 google.charts.setOnLoadCallback(drawChart);
// Draw the chart and set the chart values
function drawChart() {
    const pie = document.querySelector("#pie");
    const bar = document.querySelector("#bar");
    let chart = document.querySelector('#chart');
    let f0v = f0.innerHTML;
 var data = google.visualization.arrayToDataTable([
          ['title', 'Hours per Day'],
          ['F0',  3],
          ['F1',      2],
          ['F2',  2],
        ]);
//alert(f0.innerHTML)
  // Optional; add a title and set the width and height of the chart
  var options = {
        'title':'Thống kê {{p.title}}'
   };

  //Display the chart inside the <div> element with id="piechart"
    function drawPieChart() {
          var piechart = new google.visualization.PieChart(chart);
          piechart.draw(data, options);
          pie.style.color = 'white';
          bar.style.color = '#c4dce8';
          bar.onclick = drawBarChart;
     }
     function drawBarChart() {
          var barchart = new google.visualization.ColumnChart(chart);
          barchart.draw(data, options);
          bar.style.color = 'white';
          pie.style.color = '#c4dce8';
          pie.onclick = drawPieChart;
     }
    window.onresize = doALoadOfStuff;
    drawPieChart()
    function doALoadOfStuff() {
        drawPieChart();
        drawBarChart()
    }
  }
var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
  return new bootstrap.Tooltip(tooltipTriggerEl)
})




</script>
{% endif %}
{% endblock%}


