{% extends "demo/base.html" %}
{% block title %}index{% endblock %}

{% block content %}
{% if p != ''%}
<h4>Thông tin Quận/Huyện {{total.title}} (đã trừ các trường hợp hết cách ly)</h4>
<div style="overflow-x:auto;">
    <table class="table table-striped table-hover table-responsive">
        <thead>
        <tr>
            <th>Số Ca F0</th>
            <th>Số Ca F1</th>
            <th>Số Ca F2</th>
            <th>Tong số lượng cách ly tại {{users.0.district}}</th>
            <th>Số lượng ca nhiễm mới ngày {% now "d/m/Y" %}</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>{{total.f0}}</td>
            <td>{{total.f1}}</td>
            <td>{{total.f2}}</td>
            <td>{{total.isolation}} ( F1: {{total.isolationf1}} ca, F2: {{total.isolationf2}} ca )</td>
            <td>{{total.newf}}</td>
        </tr>
    </table>
    <h4>Thông tin chi tiết về các ca mắc tại Quận/Huyện {{total.title}}</h4>
</div>
<input class="form-control" id="myInput" type="text" placeholder="Tìm..">
<div style="overflow-x:auto; overflow-y:auto; max-height:500px">
    <table class="table table-striped table-hover js-sort-table table-responsive">
        <thead class="sticky-top bg-light">
        <tr>
            <th scope="col">Tên </th>
            <th scope="col">Số ca F0</th>
            <th scope="col">Số ca F1</th>
            <th scope="col">Số ca F2</th>
            <th>Số lượng cách ly </th>
            <th>Số lượng ca nhiễm mới ngày {% now "d/m/Y" %}</th>
        </tr>
        </thead>
        <tbody id="myTable">
        {% for row in detail %}
        <tr>
            <td class="field-patientcode">
                {% if row.extra %}
                <a href="{% url 'demo:province' row.extra.slug%}">{{ row.extra.proname }}</a>
                {% else %}
                -
                {% endif %}
            </td>
            <td>{{row.f0}}</td>
            <td>{{row.f1}}</td>
            <td>{{row.f2}}</td>
            <td>{{row.isolation}} ( F1: {{row.isolationf1}} ca, F2: {{row.isolationf2}} ca )</td>
            <td>{{row.newf}}</td>
        </tr>
        {% endfor %}

        </tbody>
    </table>

</div>
{% endif%}
{% endblock %}

{% block chart %}
{% if p != '' %}
<div class="breadcrumbs">
    <i class="fas fa-chart-line" id="f" data-toggle="tooltip" data-placement="bottom" title="Ca nhiễm"></i>
    <i class="fas fa-calendar-alt" id="new" data-toggle="tooltip"
               data-placement="top" title="Ca nhiễm mới"></i>
</div>
<div id="container" style="width:100%;">
    <canvas id="population-chart" data-url=""></canvas>
  </div>
  <script>
    //chart
    const f = document.querySelector("#f");
    const newf = document.querySelector("#new");
    let lable1 = 'Số ca nhiễm';
    let data1 = {{ data|safe }};
    let chart = (lable,data1) => {
      var $populationChart = $("#population-chart");
      console.log(lable)
      $.ajax({
        url: $populationChart.data("url"),
        success: function (data) {
          var ctx = $populationChart[0].getContext("2d");
          new Chart(ctx, {
            type: 'bar',
            data: {
              labels: {{ labels|safe }},
              datasets: [{
                label: lable,
                backgroundColor: 'blue',
                data: data1
              }]
            },
            options: {
              responsive: true,
              legend: {
                position: 'top',
              },
              title: {
                display: true,
                text: 'Số ca nhiễm phân bổ theo xã'
              }
            }
          });

        }
      });
      }
    chart(lable1,data1);
    f.onclick = () => {
         lable1 = 'Số ca nhiễm';
         data1 = {{ data|safe }};
         chart(lable1,data1);
    }
    newf.onclick = () => {
         lable1 = 'Số ca nhiễm mới ngày {% now "d/m/Y" %}';
         data1 = {{ datanew|safe }};
         chart(lable1,data1);
    }


  </script>
{% endif %}
{% endblock%}

